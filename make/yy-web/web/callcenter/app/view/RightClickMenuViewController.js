/*
 * File: app/view/RightClickMenuViewController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.RightClickMenuViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.rightclickmenu',

    onRightClickMenuClick: function (menu, item, e, eOpts) {
        var record = menu.record.data;

        var storeId = menu.storeId;
        var refreshUrl = menu.refreshUrl;
        if (item.itemId === 'deleteItem') {
            Ext.MessageBox.confirm('请确认', '删除后无法恢复，您确认删除吗？', function (btn) {
                if (btn === 'no') {
                    return;
                } else if (btn === 'yes') {

                    var targetDel = menu.targetDel;

                    /**获取LoginSuccessJsonStore中的data**/
                    var LoginSuccessStore = Ext.getStore('LoginSuccessJsonStore');
                    var userId = LoginSuccessStore.data.items[0].data.userId;
                    var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
                    Ext.Ajax.request({
                        url: url + targetDel,
                        params: {
                            content: JSON.stringify(record),
                            userId: userId,

                        },
                        success: function (response) {
                            var text = response.responseText;
                            var result = JSON.parse(text);

                            if (result === null) {
                                Ext.Msg.alert('提示', '操作出错了，结果：' + text);
                                return;
                            }

                            if (result.succeed === true) {

                                /****删除成功后刷新页面*****/
                                var hgStatusStore = Ext.getStore(storeId);
                                var ajaxProxy = hgStatusStore.getProxy();
                                var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
                                ajaxProxy.setUrl(url + refreshUrl);
                                hgStatusStore.load();

                            } else {
                                Ext.Msg.alert('提示', '保存出错了，错误：' + result.ptError);
                            }
                        }
                    });

                }
            });


        } else if (item.itemId === 'copyItem') {

            if (record === undefined) {
                Ext.Msg.alert('提示信息', '未选择任何数据！');
            } else {
                var copyText = '姓名：' + record.f_name + '-' +
                    '电话:' + record.f_phone + '-' + '状态:' + record.status + '-';
            }

        }
    }

});
