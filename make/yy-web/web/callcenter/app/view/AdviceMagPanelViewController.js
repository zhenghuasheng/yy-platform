/*
 * File: app/view/AdviceMagPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.AdviceMagPanelViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.advicemagpanel',

    onRefreshBtnClick: function(button, e, eOpts) {
        this.onAdvicemagGridPanelRend(null,null);
    },

    onAdvicemagGridPanelRend: function(component, eOpts) {
        var AdviceStore = Ext.getStore('AdviceStore');

        var ajaxProxy = AdviceStore.getProxy();
        var url = Ext.getStore('ConfigStore').getAt(0).get('OrderUrl');

        ajaxProxy.setUrl(url + "/biz/res/list.do");
        AdviceStore.load();
    },

    onAdvicemagGridPanelRowDblClick: function(tableview, record, tr, rowIndex, e, eOpts) {
        //1，详情窗口显示
        var AdviceReadWindow=new CallCenterApp.view.AdviceReadWindow();

        AdviceReadWindow.show();

        var adviceContentText = AdviceReadWindow.down('#adviceContentText');

        adviceContentText.setData('<font style="line-height:1.5;" color="blue">'+record.data.f_content+'<font/>');

        //2,反馈状态修改

        if(!record.data.f_read){

            var url = Ext.getStore('ConfigStore').getAt(0).get('OrderUrl');
            Ext.Ajax.request({
                url: url + '/biz/res/modify.do',
                params: {
                    f_rpid:record.data.f_rpid,
                    f_read:true

                },
                success: function (response) {
                    var text = response.responseText;
                    var result = JSON.parse(text);

                    if (result === null) {
                        Ext.Msg.alert('提示', '保存出错了，结果：' + text);
                        return;
                    }

                    if (result.succeed === true) {

                    } else {
                        Ext.Msg.alert('提示', '保存出错了，错误：' + result.errMsg);
                    }
                }
            });

        }



    }

});
