/*
 * File: app/view/HgCarOrderReuqestPanel.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.HgCarOrderReuqestPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.hgcarorderreuqestpanel',

    requires: [
        'CallCenterApp.view.HgCarOrderReuqestPanelViewModel',
        'CallCenterApp.view.HgCarOrderReuqestPanelViewController',
        'Ext.button.Button',
        'Ext.form.field.ComboBox',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.grid.column.Action',
        'Ext.toolbar.Paging',
        'Ext.grid.View',
        'Ext.selection.CheckboxModel',
        'Ext.grid.property.Grid'
    ],

    controller: 'hgcarorderreuqestpanel',
    viewModel: {
        type: 'hgcarorderreuqestpanel'
    },
    height: 622,
    id: 'HgCarOrderReuqestPanel',
    itemId: 'HgCarOrderReuqestPanel',
    width: 743,
    layout: 'border',
    closable: true,
    title: '购车单报价',

    items: [
        {
            xtype: 'container',
            flex: 4,
            region: 'center',
            layout: 'border',
            items: [
                {
                    xtype: 'gridpanel',
                    flex: 12,
                    region: 'center',
                    split: false,
                    frame: true,
                    itemId: 'HgCarOrderGridPanel',
                    title: '购车订单信息',
                    allowDeselect: true,
                    columnLines: true,
                    store: 'CarOrderStore',
                    dockedItems: [
                        {
                            xtype: 'toolbar',
                            dock: 'top',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'RefreBtn',
                                    width: 49,
                                    text: '刷新',
                                    listeners: {
                                        click: 'onRefreBtnClick'
                                    }
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'signBtn',
                                    text: '已签约',
                                    listeners: {
                                        click: 'onSignBtnClick'
                                    }
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'CarOrdertype',
                                    width: 150,
                                    fieldLabel: '订单类型',
                                    labelWidth: 60,
                                    displayField: 'name',
                                    store: 'CarOrdertypeStore',
                                    valueField: 'id'
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'CarOrderStatus',
                                    width: 150,
                                    fieldLabel: '订单状态',
                                    labelWidth: 60,
                                    displayField: 'name',
                                    store: 'CarOrderStatusStore',
                                    valueField: 'id'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'QueryBtn',
                                    text: '查询',
                                    listeners: {
                                        click: 'onQueryBtnClick'
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'bottom',
                            frame: true,
                            width: 360,
                            afterPageText: '页   共{0}页',
                            beforePageText: '第',
                            displayInfo: true,
                            emptyMsg: '无信息',
                            firstText: '第一页',
                            lastText: '最后一页',
                            nextText: '下一页',
                            prependButtons: true,
                            prevText: '上一页',
                            refreshText: '刷新',
                            store: 'CarOrderStore'
                        }
                    ],
                    columns: [
                        {
                            xtype: 'rownumberer',
                            width: 76,
                            align: 'center',
                            dataIndex: 'string',
                            text: '序号'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 167,
                            align: 'center',
                            dataIndex: 'title',
                            text: '车型名称'
                        },
                        {
                            xtype: 'gridcolumn',
                            align: 'center',
                            dataIndex: 'f_color',
                            text: '车辆颜色'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(value===0){
                                    return '已作废';
                                }else if(value===1){
                                    //     if(record.data.type===1){
                                    //         return '已跟进';
                                    //     }else{
                                    //         return '已报价';
                                    //     }
                                    return '询价';

                                }else if(value===2){
                                    return '已报价';
                                }else if(value===3){
                                    return '已支付';
                                }else if(value===4){
                                    return '已过期';
                                }else if(value===5){
                                    return '待提车';
                                }else if(value===6){
                                    return '已完成';
                                }
                            },
                            align: 'center',
                            dataIndex: 'f_status',
                            text: '购车单状态'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 127,
                            align: 'center',
                            dataIndex: 'guidePrice',
                            text: '指导价格(万)'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if(value!==undefined&&value!==null&&value!==''){

                                    var V= Ext.util.Format.number(value/10000,'0.00');
                                    return V;
                                }else{
                                    return value;
                                }
                            },
                            width: 103,
                            dataIndex: 'f_bottomprice',
                            text: '最低价(万)'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 124,
                            align: 'center',
                            dataIndex: 'f_operator',
                            text: '操作员'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 167,
                            align: 'center',
                            dataIndex: 'f_operatetime',
                            text: '操作时间',
                            format: 'Y-m-d H:i:s'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 150,
                            align: 'center',
                            dataIndex: 'f_createtime',
                            text: '创建时间',
                            format: 'Y-m-d H:i:s'
                        },
                        {
                            xtype: 'actioncolumn',
                            align: 'center',
                            text: '操作',
                            items: [
                                {
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {

                                        var status=record.data.f_status;

                                        if(status===0||status===4){
                                            Ext.Msg.alert('提示','此购车订单已作废或已过期');
                                            return;
                                        }

                                        Ext.MessageBox.confirm('请确认', '您确认是否作废此购车单？', function(btn){
                                            if(btn==='no'){
                                                return;
                                            }else if(btn==='yes'){
                                                var orderId=record.data.f_ofid;
                                                var url = Ext.getStore('ConfigStore').getAt(0).get('OrderUrl');
                                                /**获取LoginSuccessJsonStore中的data**/
                                                var LoginSuccessStore = Ext.getStore('LoginSuccessJsonStore');
                                                var userId=LoginSuccessStore.data.items[0].data.userId;
                                                var userName=LoginSuccessStore.data.items[0].data.userName;

                                                Ext.Ajax.request({
                                                    url: url + '/biz/order/cancel.do',
                                                    params: {
                                                        orderId:orderId,
                                                        operatorId:userId,
                                                        operator:userName
                                                    },
                                                    success: function (response) {
                                                        var text = response.responseText;
                                                        var result = JSON.parse(text);

                                                        if (result === null) {
                                                            Ext.Msg.alert('提示', '操作出错了，结果：' + text);
                                                            return;
                                                        }

                                                        if (result.succeed === true) {
                                                            Ext.Msg.alert('提示', '操作成功');

                                                            /**成功操作后，刷新页面信息***/
                                                            view.store.load();


                                                        } else {
                                                            Ext.Msg.alert('提示', '操作出错了');
                                                        }
                                                    }
                                                });

                                            }
                                        });


                                    },
                                    altText: '失效操作',
                                    iconCls: 'Cancel'
                                }
                            ]
                        }
                    ],
                    listeners: {
                        render: 'onHgCarOrderGridPanelRender',
                        selectionchange: 'onHgCarOrderGridPanelSelectionChange'
                    },
                    selModel: {
                        selType: 'checkboxmodel',
                        allowDeselect: true,
                        mode: 'SINGLE'
                    }
                },
                {
                    xtype: 'propertygrid',
                    flex: 4,
                    region: 'east',
                    split: true,
                    autoScroll: true,
                    frame: true,
                    id: 'CarOrderDetailPropertyPanel',
                    itemId: 'CarOrderDetailPropertyPanel',
                    width: 169,
                    animCollapse: true,
                    bodyBorder: true,
                    collapsible: true,
                    title: '购车单详情',
                    titleCollapse: true,
                    listeners: {
                        propertychange: 'onCarOrderDetailPropertyPanelPropertyChange'
                    }
                }
            ]
        },
        {
            xtype: 'gridpanel',
            flex: 2,
            region: 'south',
            height: 150,
            itemId: 'CarAskPriceGridPanel',
            title: '询价记录',
            columnLines: true,
            store: 'CarReportPriceStore',
            dockedItems: [
                {
                    xtype: 'toolbar',
                    dock: 'top',
                    items: [
                        {
                            xtype: 'button',
                            itemId: 'bottomPricesubmitBtn',
                            text: '底价报价',
                            listeners: {
                                click: 'onBottomPricesubmitBtnClick'
                            }
                        }
                    ]
                }
            ],
            columns: [
                {
                    xtype: 'rownumberer',
                    width: 64,
                    align: 'center',
                    dataIndex: 'string',
                    text: '序号'
                },
                {
                    xtype: 'gridcolumn',
                    width: 156,
                    align: 'center',
                    dataIndex: 'f_cartype',
                    text: '车辆型号'
                },
                {
                    xtype: 'gridcolumn',
                    align: 'center',
                    dataIndex: 'f_color',
                    text: '车辆颜色'
                },
                {
                    xtype: 'gridcolumn',
                    width: 120,
                    align: 'center',
                    dataIndex: 'f_ncname',
                    text: '经销商名称'
                },
                {
                    xtype: 'gridcolumn',
                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                        if(value!==undefined&&value!==null&&value!==''){

                            var V= Ext.util.Format.number(value/10000,'0.00');
                            return V;
                        }
                    },
                    align: 'center',
                    dataIndex: 'f_price',
                    text: '报价(万)'
                },
                {
                    xtype: 'gridcolumn',
                    align: 'center',
                    dataIndex: 'f_saleman',
                    text: '销售代表'
                },
                {
                    xtype: 'datecolumn',
                    width: 135,
                    align: 'center',
                    dataIndex: 'f_validtime',
                    text: '有效时间',
                    format: 'Y-m-d H:i:s'
                },
                {
                    xtype: 'gridcolumn',
                    align: 'center',
                    dataIndex: 'userName',
                    text: '操作员'
                }
            ],
            selModel: {
                selType: 'checkboxmodel',
                allowDeselect: true,
                mode: 'SINGLE'
            }
        }
    ]

});