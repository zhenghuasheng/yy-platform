/*
 * File: app/view/HgRequestPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.HgRequestPanelViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.hgrequestpanel',

    onSaveBtnClick: function (button, e, eOpts) {
        var hgRequestPanel = button.up('#hgRequestPanel');
        var nameField = hgRequestPanel.down('#nameField');
        var phoneField = hgRequestPanel.down('#phoneField');
        var idCardField = hgRequestPanel.down('#idCardField');

        if (!nameField.validate() || !phoneField.validate() || !idCardField.validate()) {
            Ext.Msg.alert('提示', '请正确填写信息.');
            return;
        }

        var marryField = hgRequestPanel.down('#marryField');
        var wifeNameField = hgRequestPanel.down('#wifeNameField');
        var wifePhoneField = hgRequestPanel.down('#wifePhoneField');
        var wifeIdCardField = hgRequestPanel.down('#wifeIdCardField');

        if (marryField.getValue() === 1) {
            if (!wifeNameField.validate() || !wifePhoneField.validate() || !wifeIdCardField.validate()) {
                Ext.Msg.alert('提示', '请正确填写信息.');
                return;
            }
        }

        var sexField = hgRequestPanel.down('#sexField');
        var provinceField = hgRequestPanel.down('#provinceField');
        var cityField = hgRequestPanel.down('#cityField');
        var districtField = hgRequestPanel.down('#districtField');
        var streetField = hgRequestPanel.down('#streetField');
        var addressField = hgRequestPanel.down('#addressField');
        var houseField = hgRequestPanel.down('#houseRadioGroup');
        var mpayField = hgRequestPanel.down('#mpayField');
        var buyDateField = hgRequestPanel.down('#buyDateField');
        var rentDateField = hgRequestPanel.down('#rentDateField');
        var areaField = hgRequestPanel.down('#areaField');
        var houseAddrField = hgRequestPanel.down('#houseAddrField');
        var companyField = hgRequestPanel.down('#company');
        var jobField = hgRequestPanel.down('#jobTitle');
        var jobAgeField = hgRequestPanel.down('#jobAge');
        var incomeField = hgRequestPanel.down('#incomeField');
        var otherIncomeField = hgRequestPanel.down('#otherIncomeField');
        var bankSeriaField = hgRequestPanel.down('#bankSeriaField');
        var outDateField = hgRequestPanel.down('#outDateRadioGroup');
        var outNumField = hgRequestPanel.down('#outNumField');
        var buyCarInChangsha = hgRequestPanel.down('#buyCarInChangsha');
        var useCarCityField = hgRequestPanel.down('#useCarCityField');
        var loveCarField = hgRequestPanel.down('#loveCarField');
        var lookedCarField = hgRequestPanel.down('#lookedCarField');
        var carPriceField = hgRequestPanel.down('#carPriceField');
        var depositField = hgRequestPanel.down('#depositField');
        var loanMoneyField = hgRequestPanel.down('#loanMoneyField');

        var wifeCompanyField = hgRequestPanel.down('#wifeCompany');
        var wifeJobField = hgRequestPanel.down('#wifeJobTitle');
        var wifeJobAgeField = hgRequestPanel.down('#wifeJobAge');
        var wifeIncomeField = hgRequestPanel.down('#wifeIncomeField');
        var wifeBankSeriaField = hgRequestPanel.down('#wifeBankSeriaField');
        var wifeOtherIncomeField = hgRequestPanel.down('#wifeOtherIncomeField');
        var buyDate = buyDateField.getValue();
        buyDate = (buyDate === null) ? 0 : buyDate.getTime() / 1000;
        var rentDate = rentDateField.getValue();
        rentDate = (rentDate === null) ? 0 : rentDate.getTime() / 1000;

        var data = {
            'id': hgRequestPanel.f_ciid,
            'name': nameField.getValue(),
            'idCard': idCardField.getValue(),
            'phone': phoneField.getValue(),
            'sex': sexField.getValue().sex,
            'married': marryField.getValue().marry,
            'province': provinceField.getValue(),
            'city': cityField.getValue(),
            'region': districtField.getValue(),
            'street': streetField.getValue(),
            'address': addressField.getValue(),
            'house': houseField.getValue().house,
            'monthPay': mpayField.getValue(),
            'buyDate': buyDate,
            'rentDate': rentDate,
            'area': areaField.getValue(),
            'houseAddr': houseAddrField.getValue(),
            'company': companyField.getValue(),
            'job': jobField.getValue(),
            'jobAge': jobAgeField.getValue(),
            'income': incomeField.getValue().income,
            'otherIncome': otherIncomeField.getValue(),
            'bankSeria': bankSeriaField.getValue().bank,
            'outDate': outDateField.getValue().outdate,
            'outNum': outNumField.getValue(),
            'buyCarInChangsha': buyCarInChangsha.getValue().city,
            'useCarCity': useCarCityField.getValue(),
            'loveCar': loveCarField.getValue(),
            'lookedCar': lookedCarField.getValue().look,
            'carPrice': carPriceField.getValue(),
            'deposit': depositField.getValue().deposit,
            'loanMoney': loanMoneyField.getValue(),

            'wifeName': wifeNameField.getValue(),
            'wifePhone': wifePhoneField.getValue(),
            'wifeIdCard': wifeIdCardField.getValue(),
            'wifeCompany': wifeCompanyField.getValue(),
            'wifeJob': wifeJobField.getValue(),
            'wifeJobAge': wifeJobAgeField.getValue(),
            'wifeIncome': wifeIncomeField.getValue().wifeincome,
            'wifeBankSeria': wifeBankSeriaField.getValue().wifebank,
            'wifeOtherIncome': wifeOtherIncomeField.getValue(),
            'system': '100'

        };

        var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');

        Ext.Ajax.request({
            headers: {'Content-Type': 'application/json'},
            url: url + '/action/hgInfo/submit.do',
            params: JSON.stringify(data),
            success: function (response) {
                var text = response.responseText;
                var result = JSON.parse(text);

                if (result === null) {
                    Ext.Msg.alert('提示', '保存出错了，结果：' + text);
                    return;
                }

                if (result.succeed === true) {
                    Ext.Msg.alert('提示', '保存成功');
                } else {
                    Ext.Msg.alert('提示', '保存出错了，错误：' + result.errMsg);
                }
            }
        });

    },

    onHgRequestPanelAfterRender: function (component, eOpts) {
        var deptStore = Ext.getStore('DeptStore');
        var ajaxProxy = deptStore.getProxy();
        var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
        ajaxProxy.setUrl(url + "/action/hg/department.do");
        deptStore.load();

        var provinceStore = Ext.getStore('ProvinceStore');
        var ajaxProxy = provinceStore.getProxy();
        var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
        ajaxProxy.setUrl(url + "/region/province.do");
        provinceStore.load();
    },

    onMarryFieldChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        var wifeContainer = hgRequestPanel.down('#wifeContainer');
        var wifeJobContainer = hgRequestPanel.down('#wifeJobContainer');
        var wifeIncomeContainer = hgRequestPanel.down('#wifeIncomeContainer');

        if (newValue.marry === '1') {
            wifeContainer.show();
            wifeJobContainer.show();
            wifeIncomeContainer.show();
        } else {
            wifeContainer.hide();
            wifeJobContainer.hide();
            wifeIncomeContainer.hide();
        }

        hgRequestPanel.updateLayout();

    },

    onModifyAddressBtnClick: function (button, e, eOpts) {
        var hgRequestPanel = button.up('#hgRequestPanel');
        var addressContainer = hgRequestPanel.down('#addressContainer');
        addressContainer.show();
        hgRequestPanel.updateLayout();
    },

    onProvinceFieldChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        hgRequestPanel.down('#cityField').reset();
        var cityStore = Ext.getStore('CityStore');
        var ajaxProxy = cityStore.getProxy();
        var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
        ajaxProxy.setUrl(url + "/region/city.do?proid=" + newValue);
        cityStore.load();

    },

    onCityFieldChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        hgRequestPanel.down('#districtField').reset();
        var districtStore = Ext.getStore('DistrictStore');
        var ajaxProxy = districtStore.getProxy();
        var url = Ext.getStore('ConfigStore').getAt(0).get('WebServerUrl');
        ajaxProxy.setUrl(url + "/region/district.do?cityid=" + newValue);
        districtStore.load();
    },

    onFinishBtnClick: function (button, e, eOpts) {
        var hgRequestPanel = button.up('#hgRequestPanel');
        var addressContainer = hgRequestPanel.down('#addressContainer');
        addressContainer.hide();
        hgRequestPanel.updateLayout();
        var province = hgRequestPanel.down('#provinceField').getDisplayValue();
        var city = hgRequestPanel.down('#cityField').getDisplayValue();
        var district = hgRequestPanel.down('#districtField').getDisplayValue();
        var street = hgRequestPanel.down('#streetField').getValue();
        hgRequestPanel.down('#addressField').setValue(province + city + district + street);
    },

    onHouseRadioGroupChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        var mpayField = hgRequestPanel.down('#mpayField');
        var buyDateField = hgRequestPanel.down('#buyDateField');
        var areaField = hgRequestPanel.down('#areaField');
        var addressField = hgRequestPanel.down('#houseAddrField');
        var rentDateField = hgRequestPanel.down('#rentDateField');

        if (newValue.house === '0') {
            mpayField.show();
            buyDateField.show();
            areaField.show();
            addressField.hide();
            rentDateField.hide();
        } else if (newValue.house === '1') {
            mpayField.hide();
            buyDateField.hide();
            areaField.hide();
            addressField.show();
            rentDateField.show();
        } else if (newValue.house === '2') {
            mpayField.hide();
            buyDateField.hide();
            areaField.show();
            addressField.show();
            rentDateField.hide();
        }

        var houseContainer = hgRequestPanel.down('#houseContainer');
        houseContainer.updateLayout();
    },

    onIncomeFieldChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        var otherIncomeField = hgRequestPanel.down('#otherIncomeField');

        if (newValue.income === '5') {
            otherIncomeField.show();
            var incomeContainer = hgRequestPanel.down('#incomeContainer');
            incomeContainer.updateLayout();
        } else {
            otherIncomeField.hide();
        }

    },

    onWifeIncomeFieldChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        var wifeOtherIncomeField = hgRequestPanel.down('#wifeOtherIncomeField');

        if (newValue.wifeincome === '5') {
            wifeOtherIncomeField.show();
            var incomeContainer = hgRequestPanel.down('#incomeContainer');
            incomeContainer.updateLayout();
        } else {
            wifeOtherIncomeField.hide();
        }

    },

    onOutDateRaidoGroupChange: function (field, newValue, oldValue, eOpts) {
        var hgRequestPanel = field.up('#hgRequestPanel');
        var outNumField = hgRequestPanel.down('#outNumField');

        if (newValue.outdate === '0') {
            outNumField.hide();
        } else {
            outNumField.show();
            var creditContainer = hgRequestPanel.down('#creditContainer');
            creditContainer.updateLayout();
        }
    }

});
