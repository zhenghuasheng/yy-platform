/*
 * File: app/view/HgCarDirectMagPanel.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.HgCarDirectMagPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.hgcardirectmagpanel',

    requires: [
        'CallCenterApp.view.HgCarDirectMagPanelViewModel',
        'CallCenterApp.view.HgCarDirectMagPanelViewController',
        'Ext.toolbar.Toolbar',
        'Ext.form.field.ComboBox',
        'Ext.button.Button',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Date',
        'Ext.grid.column.Action',
        'Ext.grid.View',
        'Ext.grid.property.Grid'
    ],

    controller: 'hgcardirectmagpanel',
    viewModel: {
        type: 'hgcardirectmagpanel'
    },
    frame: true,
    height: 589,
    id: 'HgCarDirectMagPanel',
    itemId: 'HgCarDirectMagPanel',
    width: 777,
    layout: 'fit',
    bodyBorder: true,
    closable: true,
    title: '直销车辆管理',

    dockedItems: [
        {
            xtype: 'toolbar',
            dock: 'top',
            autoScroll: true,
            frame: true,
            items: [
                {
                    xtype: 'combobox',
                    itemId: 'CarBrandSelect',
                    width: 200,
                    fieldLabel: '车辆品牌',
                    labelWidth: 60,
                    editable: false,
                    displayField: 'name',
                    store: 'CarBrandStord',
                    valueField: 'id',
                    listeners: {
                        render: 'onCarBrandSelectRender',
                        select: 'onCarBrandSelectSelect'
                    }
                },
                {
                    xtype: 'combobox',
                    itemId: 'CarsetSelect',
                    width: 170,
                    fieldLabel: '车系',
                    labelWidth: 30,
                    editable: false,
                    displayField: 'name',
                    store: 'CarsetStore',
                    valueField: 'id',
                    listeners: {
                        select: 'onCarsetSelectSelect'
                    }
                },
                {
                    xtype: 'combobox',
                    itemId: 'CarTypeSelect',
                    width: 170,
                    fieldLabel: '车型',
                    labelWidth: 30,
                    displayField: 'name',
                    store: 'CarTypeStore',
                    valueField: 'id'
                },
                {
                    xtype: 'combobox',
                    itemId: 'CarStatusSelect',
                    width: 103,
                    fieldLabel: '状态',
                    labelWidth: 30,
                    editable: false,
                    displayField: 'name',
                    store: 'HgCarDrictStatusStore',
                    valueField: 'value'
                },
                {
                    xtype: 'button',
                    itemId: 'ResetBtn',
                    text: '重置',
                    listeners: {
                        click: 'onResetBtnClick'
                    }
                },
                {
                    xtype: 'button',
                    itemId: 'QueryBtn',
                    text: '查询',
                    listeners: {
                        click: 'onQueryBtnClick'
                    }
                }
            ]
        }
    ],
    items: [
        {
            xtype: 'container',
            height: 453,
            width: 770,
            layout: 'border',
            items: [
                {
                    xtype: 'gridpanel',
                    flex: 6,
                    region: 'center',
                    itemId: 'CarDirectListGridPanel',
                    title: '直销车辆列表',
                    store: 'HgCarDirectStore',
                    columns: [
                        {
                            xtype: 'rownumberer',
                            width: 53,
                            align: 'center',
                            dataIndex: 'string',
                            text: '序号'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 205,
                            align: 'center',
                            dataIndex: 'title',
                            text: '车型名称'
                        },
                        {
                            xtype: 'gridcolumn',
                            align: 'center',
                            dataIndex: 'color',
                            text: '车辆颜色'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function (value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value !== undefined && value !== null && value !== '') {
                                    var v = Ext.util.Format.number(value / 10000, '0.00');
                                    return v;

                                } else {
                                    return value;
                                }
                            },
                            align: 'center',
                            dataIndex: 'directPrice',
                            text: '直销价格(万)'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function (value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value !== undefined && value !== null && value !== '') {
                                    if (value === 0) {
                                        return '弘高融资';
                                    } else if (value === 1) {
                                        return '直销车辆';
                                    }

                                } else {
                                    return value;
                                }

                            },
                            align: 'center',
                            dataIndex: 'type',
                            text: '车辆来源'
                        },
                        {
                            xtype: 'gridcolumn',
                            align: 'center',
                            dataIndex: 'operator',
                            text: '操作员姓名'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 123,
                            align: 'center',
                            dataIndex: 'operateTime',
                            text: '最后操作时间',
                            format: 'Y-m-d H:i:s'
                        },
                        {
                            xtype: 'actioncolumn',
                            text: '操作',
                            items: [
                                {
                                    handler: function (view, rowIndex, colIndex, item, e, record, row) {
                                        var HgCarDirectMagPanel = view.up('#HgCarDirectMagPanel');


                                        var CarsetSelect = HgCarDirectMagPanel.down('#CarsetSelect');

                                        var CarTypeSelect = HgCarDirectMagPanel.down('#CarTypeSelect');

                                        var CarStatusSelect = HgCarDirectMagPanel.down('#CarStatusSelect');

                                        var Carset = '';
                                        var CarType = '';
                                        var CarStatus = '';
                                        if (CarsetSelect.value !== null) {
                                            Carset = CarsetSelect.getValue();
                                        }

                                        if (CarTypeSelect.value !== null) {
                                            CarType = CarTypeSelect.getValue();
                                        }
                                        if (CarStatusSelect.value !== null) {
                                            CarStatus = CarStatusSelect.getValue();
                                        }

                                        /**获取LoginSuccessJsonStore中的data**/
                                        var LoginSuccessStore = Ext.getStore('LoginSuccessJsonStore');
                                        var userId = LoginSuccessStore.data.items[0].data.userId;

                                        var url = Ext.getStore('ConfigStore').getAt(0).get('OrderServerUrl');
                                        Ext.Ajax.request({
                                            url: url + '/hg/car/direct/remove.do',
                                            params: {
                                                id: record.data.id,
                                                operatorId: userId
                                            },
                                            success: function (response) {
                                                var text = response.responseText;
                                                var result = JSON.parse(text);

                                                if (result === null) {
                                                    Ext.Msg.alert('提示', '保存出错了');
                                                    return;
                                                }

                                                if (result.succeed === true) {
                                                    var HgCarDirectStore = Ext.getStore('HgCarDirectStore');

                                                    var ajaxProxy = HgCarDirectStore.getProxy();

                                                    ajaxProxy.setUrl(url + "/hg/car/direct/list.do?carsetId=" + Carset + '&carId=' + CarType + '&status=' + CarStatus);
                                                    HgCarDirectStore.load();


                                                } else {
                                                    Ext.Msg.alert('提示', '保存出错了，错误：' + result.errMsg);
                                                }
                                            }
                                        });
                                    },
                                    getClass: function (v, metadata, r, rowIndex, colIndex, store) {
                                        var status = metadata.record.data.status;
                                        if (status) {
                                            this.items[0].tooltip = '是否失效';
                                            return 'Cancel';
                                        }

                                    },
                                    icon: ''
                                }
                            ]
                        }
                    ],
                    listeners: {
                        render: 'onCarDirectListGridPanelRender',
                        rowclick: 'onCarDirectListGridPanelRowClick'
                    }
                },
                {
                    xtype: 'propertygrid',
                    flex: 2,
                    region: 'east',
                    split: true,
                    id: 'HgDirectCarDetailPropertyPanel',
                    itemId: 'HgDirectCarDetailPropertyPanel',
                    width: 150,
                    animCollapse: true,
                    bodyBorder: true,
                    collapsed: false,
                    collapsible: true,
                    title: '直销车辆详情'
                }
            ]
        }
    ]

});