/*
 * File: app/view/CarsetConfigPanel.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CallCenterApp.view.CarsetConfigPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.carsetconfigpanel',

    requires: [
        'CallCenterApp.view.CarsetConfigPanelViewModel',
        'CallCenterApp.view.CarsetConfigPanelViewController',
        'Ext.tab.Panel',
        'Ext.tab.Tab',
        'Ext.grid.Panel',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Date',
        'Ext.grid.View',
        'Ext.grid.column.Action',
        'Ext.toolbar.Paging',
        'Ext.form.field.ComboBox'
    ],

    controller: 'carsetconfigpanel',
    viewModel: {
        type: 'carsetconfigpanel'
    },
    frame: true,
    height: 497,
    id: 'CarsetConfigPanel',
    itemId: 'CarsetConfigPanel',
    width: 689,
    layout: 'fit',
    bodyBorder: true,
    closable: true,
    title: '车系配置',

    items: [
        {
            xtype: 'tabpanel',
            height: 421,
            itemId: 'CarsetConfigTabPanel',
            width: 757,
            activeTab: 0,
            items: [
                {
                    xtype: 'panel',
                    height: 539,
                    itemId: 'effectCarsetPanel',
                    width: 693,
                    layout: 'fit',
                    title: '已上架车款',
                    items: [
                        {
                            xtype: 'gridpanel',
                            height: 349,
                            itemId: 'effectCarsetGridPanel',
                            title: '',
                            store: 'CarTypeConfigStore',
                            columns: [
                                {
                                    xtype: 'rownumberer',
                                    width: 64,
                                    dataIndex: 'string',
                                    text: '序号'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 406,
                                    dataIndex: 'title',
                                    text: '车款名称'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'id',
                                    text: '车型ID'
                                },
                                {
                                    xtype: 'datecolumn',
                                    dataIndex: 'operateTime',
                                    text: '生效时间',
                                    format: 'Y-m-d H:i:s'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'operator',
                                    text: '生效操作人'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    menuText: '关闭操作',
                                    text: '操作',
                                    items: [
                                        {
                                            handler: function (view, rowIndex, colIndex, item, e, record, row) {
                                                var CarsetConfigPanel = view.up('#CarsetConfigPanel');
                                                var carBrandSelector = CarsetConfigPanel.down('#carBrandSelector');
                                                var carsetSelector = CarsetConfigPanel.down('#carsetSelector');
                                                var carsetId = carsetSelector.getValue();
                                                var carBrandId = carBrandSelector.getValue();
                                                var url = Ext.getStore('ConfigStore').getAt(0).get('OrderServerUrl');

                                                /**获取LoginSuccessJsonStore中的data**/
                                                var LoginSuccessStore = Ext.getStore('LoginSuccessJsonStore');
                                                var userId = LoginSuccessStore.data.items[0].data.userId;
                                                Ext.Ajax.request({
                                                    url: url + '/hg/car/bottom/set.do',
                                                    params: {
                                                        brandId: carBrandId,
                                                        carsetId: carsetId,
                                                        carId: record.data.id,
                                                        status: false,
                                                        operatorId: userId
                                                    },
                                                    success: function (response) {
                                                        var text = response.responseText;
                                                        var result = JSON.parse(text);

                                                        if (result === null) {
                                                            Ext.Msg.alert('提示', '操作出错');
                                                            return;
                                                        }

                                                        if (result.succeed === true) {

                                                            var CarTypeConfigStore = Ext.getStore('CarTypeConfigStore');
                                                            var ajaxProxy = CarTypeConfigStore.getProxy();

                                                            var url = Ext.getStore('ConfigStore').getAt(0).get('OrderServerUrl');

                                                            ajaxProxy.setUrl(url + "/hg/car/bottom/list.do?carsetId=" + carsetId + '&status=true');
                                                            CarTypeConfigStore.load();


                                                        } else {
                                                            Ext.Msg.alert('提示', '保存出错了，错误：' + result.errMsg);
                                                        }
                                                    }
                                                });
                                            },
                                            altText: '关闭操作',
                                            iconCls: 'Cardelete'
                                        }
                                    ]
                                }
                            ],
                            dockedItems: [
                                {
                                    xtype: 'pagingtoolbar',
                                    dock: 'bottom',
                                    width: 360,
                                    displayInfo: true,
                                    store: 'CarTypeConfigStore'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'panel',
                    height: 331,
                    itemId: 'closedCarsetPanel',
                    layout: 'fit',
                    title: '未上架车款',
                    items: [
                        {
                            xtype: 'gridpanel',
                            height: 386,
                            itemId: 'closedCarsetGridPanel',
                            title: '',
                            store: 'CarTypeConfigStore',
                            columns: [
                                {
                                    xtype: 'rownumberer',
                                    width: 64,
                                    dataIndex: 'string',
                                    text: '序号'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 341,
                                    dataIndex: 'title',
                                    text: '车系名称'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'id',
                                    text: '车型ID'
                                },
                                {
                                    xtype: 'datecolumn',
                                    dataIndex: 'operateTime',
                                    text: '关闭时间'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'operator',
                                    text: '操作人'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    menuText: '开启',
                                    text: '操作',
                                    altText: '开启',
                                    items: [
                                        {
                                            handler: function (view, rowIndex, colIndex, item, e, record, row) {
                                                var CarsetConfigPanel = view.up('#CarsetConfigPanel');
                                                var carBrandSelector = CarsetConfigPanel.down('#carBrandSelector');
                                                var carsetSelector = CarsetConfigPanel.down('#carsetSelector');
                                                var carsetId = carsetSelector.getValue();
                                                var carBrandId = carBrandSelector.getValue();
                                                var url = Ext.getStore('ConfigStore').getAt(0).get('OrderServerUrl');

                                                /**获取LoginSuccessJsonStore中的data**/
                                                var LoginSuccessStore = Ext.getStore('LoginSuccessJsonStore');
                                                var userId = LoginSuccessStore.data.items[0].data.userId;
                                                Ext.Ajax.request({
                                                    url: url + '/hg/car/bottom/set.do',
                                                    params: {
                                                        brandId: carBrandId,
                                                        carsetId: carsetId,
                                                        carId: record.data.id,
                                                        status: true,
                                                        operatorId: userId
                                                    },
                                                    success: function (response) {
                                                        var text = response.responseText;
                                                        var result = JSON.parse(text);

                                                        if (result === null) {
                                                            Ext.Msg.alert('提示', '操作出错');
                                                            return;
                                                        }

                                                        if (result.succeed === true) {

                                                            var CarTypeConfigStore = Ext.getStore('CarTypeConfigStore');
                                                            var ajaxProxy = CarTypeConfigStore.getProxy();

                                                            var url = Ext.getStore('ConfigStore').getAt(0).get('OrderServerUrl');

                                                            ajaxProxy.setUrl(url + "/hg/car/bottom/list.do?carsetId=" + carsetId + '&status=false');
                                                            CarTypeConfigStore.load();


                                                        } else {
                                                            Ext.Msg.alert('提示', '保存出错了，错误：' + result.errMsg);
                                                        }
                                                    }
                                                });
                                            },
                                            iconCls: 'Carstart'
                                        }
                                    ]
                                }
                            ],
                            dockedItems: [
                                {
                                    xtype: 'pagingtoolbar',
                                    dock: 'bottom',
                                    width: 360,
                                    displayInfo: true,
                                    store: 'CarTypeConfigStore'
                                }
                            ]
                        }
                    ]
                }
            ],
            listeners: {
                tabchange: 'onTabpanelTabChange'
            }
        }
    ],
    dockedItems: [
        {
            xtype: 'toolbar',
            dock: 'top',
            items: [
                {
                    xtype: 'combobox',
                    itemId: 'carBrandSelector',
                    fieldLabel: '车辆品牌选择',
                    labelWidth: 90,
                    editable: false,
                    displayField: 'name',
                    store: 'CarBrandStord',
                    valueField: 'id',
                    listeners: {
                        render: 'onCarBrandSelectorRender',
                        select: 'onCarBrandSelectorSelect'
                    }
                },
                {
                    xtype: 'combobox',
                    itemId: 'carsetSelector',
                    fieldLabel: '车辆系别',
                    labelWidth: 70,
                    displayField: 'name',
                    store: 'CarsetStore',
                    valueField: 'id',
                    listeners: {
                        select: 'onCarsetSelectorSelect'
                    }
                }
            ]
        }
    ]

});